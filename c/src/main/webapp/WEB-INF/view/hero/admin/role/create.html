[#include "/core/head.html"/]
<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
	<h4 class="modal-title">创建角色</h4>
</div>

<div class="modal-control">
	<div id="second-ajax-modal" class="modal fade bs-modal bs-modal-large" tabindex="-1"></div>
	[@form.form commandName="createDTO" method="POST" class="form-horizontal"]
	<!-- <input type="hidden" name="format" value="json"> -->
	<div class="modal-body clearfix">
		<div class="form-body">
			<div class="form-group">
				<label class="col-md-3 control-label">角色名</label>
				<div class="col-md-9">
					<input id="roleName" name="roleName" type="text" class="form-control" placeholder="请输入角色名"/]">
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label">角色类型</label>
				<div class="col-md-9">
					<select id="roleType" name="roleType">
						<option value="0">系统默认角色</option>
						<option value="1">自定义角色</option>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-md-3 control-label">父角色</label>
				<div class="col-md-9">
					<select id="parentId" name="parentId">
						<option value="">无</option>
					[#list roles as r]
						<option value="${r.id}">${r.roleName}</option>
					[/#list]
					</select>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-footer">
		<button type="button" class="btn default" data-dismiss="modal">关闭</button>
		<button type="submit" class="btn blue">提交</button>
	</div>
	[/@form.form]
</div>

<script type="text/javascript">
$("#createDTO").validate({
	rules:{
		roleName:{
			required:true,
			minlength:3,
			maxlength:13
		}
	},
	messages:{
		roleName:{
			required:"请输入角色名称",
			minlength:"至少3个字符",
			maxlength:"最多13个字符"
		}
	}
})
$("#createDTO").on("submit", function(ev){
	ev.preventDefault();
	if(!$("#createDTO").valid()){
		return;
	}
	$.ajax({
		url:"${ctx}/back/admin/role/create",
		type:"POST",
		data:$("#createDTO").serialize(),
		dataType : "json",
		success: function(data){
			if (data.errors != undefined) {
				var error = data.errors;
				layer.alert(error[0].field + ":" + error[0].message);
				return;
			} else {
				layer.alert("创建成功！");
				$("#ajax-modal-large").modal("hide");
				table.api().ajax.reload();
			}
		}
	})
})

</script>