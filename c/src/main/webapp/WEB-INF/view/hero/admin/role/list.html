<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
[#include "/core/head.html"/][@head title="home.page.title"/]

<link rel="stylesheet" type="text/css" href="${ctx}/resources/global/js/plugin/jstree/dist/themes/default/style.min.css"/>

<!-- BEGIN BODY -->
<body class="page-header-fixed page-sidebar-fixed page-quick-sidebar-over-content">
[#include "/core/top.html"/]
<div class="container">
		<div class="row">
			<div class="col-sm-12">
			<div id="config_menu">[#include "/admin/menu.html"/]</div>
				<!-- BEGIN CONTAINER -->
				<div class="page-container">
					<!-- BEGIN CONTENT -->
					<div>
						<div class="page-content">
							<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->
							<!-- <div id="ajax-modal" class="modal fade bs-modal" tabindex="-1"></div> -->
							<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->
							<!-- BEGIN PAGE CONTENT-->
							<div class="row" style="padding-top: 10px;">
								<div class="col-md-12">
									<!-- Begin: life time stats -->
									<div class="portlet">
										<div class="portlet-title">
											<div class="caption">
												<i class="fa fa-list-ul">角色列表</i>
											</div>
											<div class="actions">
												<a href="${ctx}/back/admin/role/create" class="btn default yellow-stripe" data-toggle="modal" data-target="#ajax-modal-large">
													<i class="fa fa-plus"></i><span class="hidden-480">新增角色</span>
												</a>
											</div>
										</div>
										<div class="portlet-body">
											<div class="table-container">
												<div class="table-actions-wrapper"></div>
												<table class="table table-striped table-bordered table-hover" id="datatable_registrationcodes">
													<thead>
														<tr role="row" class="heading">
															<th>操作</th>
															<th>角色名称</th>
															<th>角色类型</th>
														</tr>
													</thead>
													<tbody>
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<!-- End: life time stats -->
								</div>
							</div>
							<!-- END PAGE CONTENT-->
						</div>
					</div>
					<!-- END CONTENT -->
				</div>
				<!-- END CONTAINER -->
			</div>
</div>
</div>
<hr />
[#include "/core/foot.html"/]



<script src="${ctx}/resources/global/js/plugin/jstree/dist/jstree.min.js" type="text/javascript"></script>

[#assign path="${ctx}/back/admin/role"/]

<script type="text/javascript">
var table;
var roleList = function(){
	/* $.post(
			"${path}",
			function(data){
				var str = "";
				var res = data.data;
				console.log(res[0].id)
				for(var i=0; i <res.length; i++){
					str += "<tr> <td>"+(res[i].roleType == 0?"<a href='${path}/distribution/permission/" + res[i].id + "' data-toggle='modal' data-target=\"#ajax-modal-large\">权限分配</a>":"<a href='javascript:void(0)'>删除</a>")+"</td><td>"
					+res[i].roleName+"</td><td>"+(res[i].roleType == 0?"系統默认":"自定义")+"</td></tr>";
				}
				$("#datatable_registrationcodes tbody").html(str);
			},
			"json"
			); */
	table = $('#datatable_registrationcodes').dataTable( {        				
		lengthChange: true,
		"bAutoWidth": true,//自动改变宽度
		//"sDom":"<'table-scrollable't><'row'<'col-md-8 col-sm-12'pli><'col-md-4 col-sm-12'>>",
		"dom": '<"top"f>rt<"bottom"pli><"clear">',
		"aLengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
        ajax:{"url": "${path}","type":"POST"},
        columns: [
        	{ data: null, render: function ( data, type, row ) {
                // Combine the first and last names into a single table field
                return '<div class="btn-group">'
						+ '	<a href="#" class="btn blue-madison btn-xs btn-operation" data-toggle="dropdown">'
						+ '		<i class="fa fa-cog"></i> 操作'
						+ '	</a>'
						+ '	<ul class="dropdown-menu pull-left">'
						+ (data.roleType == 0?'		<li><a href="${path}/distribution/permission/' + data.id + '" data-toggle="modal" data-target=\"#ajax-modal-large\">权限分配</a></li>':'<li><a href="javascript:void(0)" onclick="delRole('+data.id+')">删除</a></li>')
						+ '	</ul>' + '</div>';
            } },
            { data: "roleName" },
            { data: null, render: function ( data, type, row ) {
                // Combine the first and last names into a single table field
                return data.roleType == 0?"系統默认":"自定义"
            } }
        ],
        "order":[[0,'asc']],
        "bFilter": false,//搜索
        "sPaginationType": "full_numbers",//显示数字的翻页样式
        "oLanguage": {
        	"sLengthMenu": " _MENU_",
        	"sZeroRecords": "抱歉， 没有找到",
        	"sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
        	"sInfoEmpty": "没有数据",
        	"sInfoFiltered": "(从 _MAX_ 条数据中检索)",
        	"oPaginate": {
        	"sFirst": "首页",
        	"sPrevious": "前一页",
        	"sNext": "后一页",
        	"sLast": "尾页"
        	},
	        "sZeroRecords": "没有检索到数据",
	        "sProcessing": "<img src='./loading.gif' />"
        }
	});
}
$(function(){
	roleList();
})
//删除角色
function delRole(id) {
	$(this).unbind('click', delRole);
	if (confirm("你确定执行删除操作（此操作不可恢复！）？")) {
		$.ajax({
			url : "${ctx}/back/admin/role/delete/" + id,
			type : "POST",
			success : function(data) {
				if (data != null) {
					if (data.errors != undefined) {
						var error = data.errors;
						layer.alert(error[0].field + ":"+ error[0].message);
						return;
					} else {
						layer.alert(data.msg);
						table.api().ajax.reload();
					}
				} else {
					$(self).click(delRole);
				}
			}
		});
	}
}
</script>

</body>
<!-- END BODY -->
</html>